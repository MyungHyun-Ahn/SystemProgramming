# Chapter13 - 윈도우 메모리의 구조
## Section01 프로세스의 가상 주소 공간
모든 프로세스는 자신만의 가상 주소 공간을 가짐
* 32비트 프로세서 : 0x00000000 ~ 0xFFFFFFFF
* 64비트 프로세서 : 0x00000000, 00000000 ~ 0xFFFFFFFF, FFFFFFFF
  * 16EB(엑사바이트)의 공간 - 엄청나게 크다
* 다른 프로세스에서 소유한 메모리는 숨겨져 있으며 접근이 불가능하다.

## Section02 가상 주소 공간의 분할
파티션(partition)
* 각 프로세스의 가상 주소 공간은 분할, 각각의 분할 공간을 파티션이라 함

### 1. 널 포인터 할당 파티션
NULL 포인터 할당 연산을 수행할 경우를 대비하기 위해 준비된 영역
* 이 영역에 접근을 시도하면 접근 위반(access violation)이 발생

윈도우에서는 이 파티션에 대해서는 Reserve 조차 허용하지 않는다

### 2. 유저 모드 파티션
프로세스 내의 주소 공간에 활용될 수 있는 파티션

CPU 아키텍처별 사용 가능한 유저 모드 파티션의 크기
* x86 : ~2GB
* x86 w/3GB : ~3GB
* x64 : ~8192GB
* IA-64 : ~7152GB

특징
* 다른 프로세스는 이 공간에 접근 불가능
* 프로세스가 유지해야 하는 대부분의 데이터가 여기 저장
* 이 특성으로 인해 시스템을 좀 더 안정적으로 동작할 수 있게 한다.
* DLL 모듈은 이 파티션에 로드

나머지 절반은 커널 모드의 파티션
* 커널 코드, 디바이스 드라이버 코드, 장치 I/O 캐시 버퍼, 논페이지 풀 할당(nonpaged pool allocation), 프로세스 페이지 테이블 등을 저장하기 위해 사용
* 2GB 공간에 겨우 집어넣을 수 있었다.


x86 윈도우에서 더 큰 유저 모드 파티션 획득하기
* x86 윈도우는 3GB까지 유저 모드 파티션으로 확장할 수 있다.
* BCD를 변경하면 된다.

64비트 윈도우에서 유저 모드 파티션으로 2GB만 사용하기
* 32비트 애플리케이션을 64비트 환경으로 포팅하는 경우
* 프로세스 가용 주소 공간을 2GB 이하로 제한하는 주소 공간 샌드박스 내에서 애플리케이션을 수행하는 방식
* 기본적으로는 주소 공간 샌드박스가 켜져있다.
* 전체 유저 모드 파티션을 쓰고 싶다면 /LARGEADDRESSAWARE 링커 스위치를 이용하여 링킹되어야 함