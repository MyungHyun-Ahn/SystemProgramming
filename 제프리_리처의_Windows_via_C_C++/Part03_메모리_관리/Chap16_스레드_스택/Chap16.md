# Chapter16 - 스레드 스택
시스템은 프로세스 주소 공간에 스레드 스택으로 사용할 영역을 예약한다.
* 기본적으로 1MB의 주소 공간 예약
* 이 중 물리적 저장소로 두 개의 페이지 커밋
* /F 혹은 /STACK 옵션으로 변경할 수 있다.

애플리케이션을 빌드하는 과정 링커가 하는 일
* 스택의 크기를 .exe 혹은 .dll 파일의 PE 헤더 상에 추가
* 시스템은 스레드 스택을 생성할 때 PE 헤더의 값을 보고 활용할 영역을 예약

이와는 별로도 CreateThread나 _beginthreadex 함수를 호출할 때
* 최초로 커밋할 물리적 저장소의 크기를 변경할 수 있다.
* 매개변수 0으로 지정 - PE 헤더의 기본 커밋 크기 이용

스택의 기본 설정
* 1M의 예약된 영역과 두 페이지 크기의 커밋된 물리적 저장소를 의미

스택으로 사용할 영역
* 모든 페이지는 PAGE_READWRITE 보호 특성
* SP 레지스터가 스택으로 예약된 영역의 최상위 페이지의 끝을 가리키도록 설정
* 이 페이지가 스택을 사용할 시작 위치
* 두 번째 페이지는 가드 페이지
  * 현재는 2~3개

스택이 확장되는 경우
* 스레드가 가드 페이지 내의 저장소 접근을 시도
* 시스템이 그 사실을 알게되고
* 시스템은 가드 페이지 이하에 추가적으로 페이지를 커밋하고 현재 가드 페이지의 가드 페이지 보호 특성을 해제한 후
* 새롭게 커밋된 페이지에 가드 페이지 보호 특성을 설정한다.