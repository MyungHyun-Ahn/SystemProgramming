# Chapter19 DLL의 기본
DLL을 사용해야 하는 이유
* 애플리케이션의 기능 확장
  * DLL은 프로세스의 주소 공간에 동적으로 로드 가능
  * 애플리케이션 수행 중에도 DLL의 수행할 코드 로드 가능
* 프로젝트 관리의 단순화
* 메모리 절약
  * 두 개 이상의 애플리케이션이 동일한 DLL 사용 - 램에 단 한 번만 로드
* 리소스 공유의 촉진
* 지역화 촉진
* 플랫폼 차별성 해소
* 특수한 목적 달성

## Section01 DLL과 프로세스 주소 공간
DLL
* 독립적인 함수들로 이루어짐
* DLL을 구성하는 소스 코드 파일들은 컴파일 이후 링커에 의해 링크 작업이 수행

DLL 파일의 이미지는 애플리케이션이 DLL 파일 내에 포함된 함수를 호출하기 전 반드시 프로세스의 주소 공간에 매핑되어 있어야 한다.

링킹 방식 두 가지
* 묵시적인 로드타임 링킹(implace load-time linking)
* 명시적인 런타임 링킹(explicit run-time linking)

DLL 파일 이미지 주소공간 매핑 이후
* DLL 함수를 프로세스의 모든 스레드가 호출할 수 있게 됨
* DLL에서 생성한 모든 오브젝트는 DLL 함수를 호출하는 스레드나 프로세스가 소유하게 된다.
  * DLL 자체가 소유하는 오브젝트는 존재하지 않는다.

실행 파일 내 전역으로 선언된 정적변수는 동일한 실행 파일이 여러번 실행되더라도 공유되지 않는다.
* 카피 온 라이트 메커니즘을 이용하기 때문

## Section02 전반적인 모습
DLL 작성 절차
1. 가장 먼저 DLL이 익스포트하려고 하는 헤더 파일을 작성
   * DLL 파일을 생성하기 위한 모든 소스 코드들은 이 헤더 파일을 인클루드해야 한다.
2. C/C++ 소스 코드 모듈을 작성
    * 이 코드는 공유하지 않아도 된다.
3. 컴파일하려 .obj 모듈을 생성
4. 링크하여 단일의 DLL 이미지 파일을 생성
5. DLL의 소스 코드가 적어도 하나 이상의 함수 혹은 변수를 익스포트 하고 있는지를 확인
   * 익스포트하고 있다면 .lib 파일을 생성

DLL 사용
1. DLL 파일이 익스포트하고 있는 것을 참조하는 소스 모듈은 DLL 개발자가 작성한 헤더 파일을 인클루드
2. DLL 헤더에서 정의하고 있는 함수나 변수를 사용하여 애플리케이션 구현
3. 컴파일 -> 링크
4. 로더는 새로운 프로세스를 위한 가상 주소 공간을 생성

### 1. DLL 모듈 생성
C++ 클래스의 경우에는 같은 컴파일러를 이용하여 컴파일하는 경우에만 사용할 수 있다.


DLL 작성
* 헤더 파일을 먼저 작성하는 것이 좋다.
* 유지 보수의 편의성을 위해 DLL 별로 헤더 파일을 하나씩만 구성하는 것이 도움이된다.