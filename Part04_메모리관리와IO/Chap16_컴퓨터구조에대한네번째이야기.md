# 16장 컴퓨터 구조에 대한 네 번째 이야기

## Section 01 - 메모리 계층(Memory Hierarchy)
### 메모리의 범위와 종류

메인 메모리(Main Memory)
* RAM, 정확히 말하면 D-RAM 계열의 메모리
* 메인 메모리가 반드시 RAM일 필요는 없다.
* 그러나, 거의 모든 컴퓨터가 메인 메모리로 RAM 사용

레지스터(Register)
* CPU 내부에 내장, 연산을 위한 저장소

캐쉬(Cache)
* D-RAM 보다 빠른 S-RAM
* 캐쉬 메모리는 원래 CPU의 일부로 존재하는 메모리 개념이 아니다.
* CPU에 근접한 메모리다.

하드디스크(Hard Disk)와 이외의 저장장치들
* 하드디스크, SD카드, IO장치들

### 메모리 계층 구조
1. 레지스터
2. L1 캐쉬
3. L2 캐쉬
4. L3 캐쉬
5. 메인 메모리
6. 하드 디스크

가장 상위가 CPU와 근접하다.
* 메인 메모리를 제외한 L1, L2 캐쉬에 연산에 필요한 데이터가 있을 확률(90% 이상)이 높다.

## Section 02 - 캐쉬와 캐쉬 알고리즘
### 컴퓨터 프로그램의 일반적인 특성
1. 템퍼럴 로컬리티(Temporal Locality)
   * 프로그램 실행 시 한번 접근이 이뤄진 주소의 메모리 영역은 자주 접근하게 된다는 프로그램 특성을 표현할 때 사용

2. 스페이셜 로컬리티(Spatial Locality)
   * 주소에서 멀리 떨어지지 않은 곳일 확률이 높다는 말

캐쉬 프랜들리 코드(Cache Friendly Code)
* 캐쉬의 성능까지 고려해서 프로그램을 개발하는 것
* 굳이 노력하지 않아도 캐쉬의 도움을 충분히 받을 수 있도록 프로그램이 만들어진다.


### 캐쉬 알고리즘
L1 캐쉬로 설명
1. 데이터가 존재하는 경우 : Cache Hit
2. 데이터가 존재하지 않는 경우 : Cache Miss

데이터의 이동은 블록 단위로
* 스페이셜 로컬리티의 특성을 성능 향상에 활용

Cache Miss인 경우 블록 교체 알고리즘

캐쉬 교체 정책(Cache's Replacement Policy)
* 가장 보편적인 것이 LRU(Least-Recently Used) 알고리즘

## Section 03 - 가상 메모리(Virtual Memory)
### 물리 주소(Physical Address)
* 실제 물리적인 데이터 주소

### 가상 주소(Virtual Memory) 시스템 1
* 가상 주소 지정(Virtual Addressing) : 가상의 주소를 지정하는 것
* 가상 메모리 공간(Virtual Addressing) : 가상 주소 지정을 통해 할당 받는 것

만약 램은 4기가인데 가상 주소 지정을 4기가 하게되면?
* 하드디스크 용량이 크기 때문에 여러 프로그램에게 4기가 씩 할당해준다고 해서 문제가 되지 않는다.

단, 2가지만 고려하자.
1. 선 할당으로 인한 부담 : 작은 프로그램에 4기가나 할당해주면 낭비
2. 느린 속도의 개선 필요성 : 하드 디스크 속도가 느림

대부분 이것을 위해 페이징(Paging) 기법을 사용한다.

메모리 할당의 단위를 블록단위로 나누는 것
* 수백 바이트에서 ~
* 페이지 프레임(Page Frame) : 블록

페이지 프레임 번호 : 16비트일 경우 상위 4비트로 판단 가능

MMU (Memory management unit) : 작은 메모리를 더 큰 메모리가 존재하는 것처럼 CPU가 느끼도록 만든다.
* CPU 내부에 있는 장치이다.

### 가상 주소(Virtual Address) 시스템 2
부족한 메모리의 해결을 하드 디스크에서 진행한다.
* 스왑 파일(Swap File) : 하드 디스크를 메인 메모리로 확장해서 문제를 해결
* 속도가 느리다는 것 빼면 메인 메모리로 사용하기에 문제가 없다.
* 하드 디스크에 저장된 페이지를 불러오려면 스왑 과정을 거친다.

MMU가 스왑 파일의 LOAD와 STORE 과정을 관리한다.


즉, 가상 메모리의 구현은 MMU라는 하드웨어가 책임진다.

## 이것만은 알고 갑시다.
1. 메모리 계층별 역할과 상호작용 관계를 정리해보자

2. 캐쉬 메모리가 성능에 도움을 주는 이유
3. 가상 메모리
4. 피라미드 구조상에서 캐쉬 관계
5. MMU (Memory Management Unit)