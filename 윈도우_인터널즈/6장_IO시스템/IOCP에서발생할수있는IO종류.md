# IOCP에서 발생할 수 있는 I/O 종류
## 발생 가능한 I/O 종류 2가지
1. Fast I/O + Buffered I/O
    * 동기적으로 완료되는 경우
2. Direct I/O
    * 정말 우리가 원하는 비동기 I/O, 진짜 I/O

## Fast I/O + Buffered I/O
* 비동기 I/O로 열린 소켓이지만 동기로 완료될 수 있는 경우 Fast I/O + Buffered I/O가 진행될 수 있음

### Fast I/O
* IRP의 생성 없이 캐시된 파일을 읽거나 작업을 수행하는 방법
* Fast I/O 루틴을 호출하여 I/O 관리자는 IRP 생성 없이 직접 캐시 관리자로부터 가능한지 여부를 확인

캐시 관리자는 가상 메모리 서브시스템의 최상위에 위치
* 따라서 파일 시스템 드라이버는 캐시 관리자를 이용해 IRP 생성 시 발생하는 오버헤드 없이 I/O 진행 가능

Fast I/O가 가능하다면 비동기 I/O이더라도 Fast I/O를 수행함
* Fast I/O는 코드의 관점에서 구분됨
  * IRP 발생없이 직접 코드가 호출됨

### Buffered I/O
* I/O 관리자가 호출자의 버퍼 크기와 동일한 버퍼를 넌페이지드 풀에 할당
* 여기에 복사하여 장치 드라이버가 접근할 수 있게 하는 방법
* 장치가 DMA를 지원하지 않을 때 사용됨
* CPU에 의한 복사 작업이 항상 수행됨

여기서 말하는 넌페이지드 풀?
* TCP에서는 송수신 버퍼를 의미
* 따라서 비동기 IOCP WSASend에서는 발생하지 않음
  * 특히나 송신 버퍼를 0으로 줄인 경우 Send에서는 절대 발생하지 않음
  * WSARecv의 경우에는 발생할 수 있음

## Direct I/O
* 복사를 사용하지 않고 드라이버가 직접 사용자 버퍼에 접근할 수 있게 하는 것
* DMA(Direct Memory Access)를 사용
* 여기에 전달된 유저 버퍼는 효율적으로 이중 매핑됨
  * 추가적인 하나는 시스템 주소 공간
  * 어떤 컨텍스트에서든 사용 가능해짐
* 유저 버퍼는 4KB 페이지 단위의 페이지 락이 걸림
  * IRP가 완료된 이후 페이지 락이 해제됨

다이렉트 I/O 장점
* 복사가 이뤄지지 않으므로 큰 버퍼에 유용
* DMA 전송의 경우 특히

IOCP에서 비동기 I/O로 수행이 되면
* 무조건 Direct I/O임