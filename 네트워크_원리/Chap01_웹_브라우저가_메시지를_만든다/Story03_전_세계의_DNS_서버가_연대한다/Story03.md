# Story03 - 전 세계의 DNS 서버가 연대한다.
## 1. DNS 서버의 기본 동작
DNS 서버의 기본 동작은 클라이언트에서 조회 메시지를 받고 조회의 내용에 응답

### 조회 메시지
세 가지 정보가 포함
1. 이름
   * 서버나 메일 배송 목적지와 같은 이름
2. 클래스
   * 인터넷 이외의 네트워크 이용까지 검토하여 식별하는 용도
   * 그러나 지금은 인터넷 이외의 네트워크는 소멸
   * 따라서 항상 클래스는 'IN'이라는 값
3. 타입
   * 이름에 어떤 타입의 정보가 지원되는지 나타냄
   * 이 타입에 따라 클라이언트에 회답하는 정보와 내용이 달라짐

예를 들어 이름이 www.lab.cyber.co.kr인 서버의 IP 주소를 조사할 때 조회 메시지
1. 이름 = www.lab.cyber.co.kr
2. 클래스 = IN
3. 타입 = A

3가지 항목이 일치하는 IP 값을 클라이언트에 회답
* 꼭 웹 서버의 이름이 www로 시작할 필요는 없음

메일 배송 목적지를 조회하는 경우 tone@cyber.co.kr
1. 이름 = cyber.co.kr
2. 클래스 = A
3. 타입 = MX

메일 서버의 IP 값을 회답


정리
* DNS 서버는 서버에 등록된 도메인명과 IP 주소의 대응표를 조사하여 IP 주소를 회답

등록 정보는 리소스 레코드라는 설정 파일 등에 입력되어 있다.


## 2. 도메인의 계층
지금까지는 1대의 DNS 서버에 모든 정보가 있는 것 처럼 설명
* 실제로는 다수의 DNS 서버에 정보를 분산시켜 저장
* 즉, 다수의 DNS 서버가 연대해서 어디에 정보가 있는지 찾아내는 구조

DNS 서버에 등록한 정보는 도메인명이라는 계층적 구조를 가진 이름이 붙여져있다.
* 계층화를 통해 다수의 정보를 깔끔하게 정리
* www.lab.cyber.co.kr 처럼 점으로 계층을 구분
* 오른쪽에 있는 것이 상위의 계층
* com사업부 cyber부 lab과의 www
* 도메인 : 하나의 부서에 해당하는 것

계층화된 도메인의 정보를 서버에 등록
* 하나의 도메인을 일괄적으로 취급
* 즉, 한 개의 도메인 정보를 일괄적으로 DNS 서버에 등록, 분할하여 복수의 DNS 서버에 등록하는 것은 불가

# 3. 담당 DNS 서버를 찾아 IP 주소를 가져온다.
액세스 대상의 웹 서버가 어느 DNS 서버에 등록되어 있는지 찾아내는 방법
* DNS 서버는 수만 대로 막 찾을 수는 없다.

찾는 방법
1. 하위의 도메인을 담당하는 DNS 서버의 IP 주소를 상위의 DNS 서버에 등록
2. 그 상위의 DNS 서버를 또 그 상위의 DNS 서버에 등록하는 식으로 차례대로 등록
3. 이렇게 하면 상위의 DNS 서버에 가면 하위의 DNS 서버의 IP 주소를 알 수 있고 거기에서 조회 메시지를 보낼 수 있다.

com이나 kr이라는 도메인(최상의 도메인)의 DNS 서버에 하위의 DNS 서버를 등록한 곳에서 끝나는 것처럼 보인다.
* 그러나 이 위에 루트 도메인이 있다.
* 루트 도메인을 보통은 생략하지만 사용할 때는 com.으로 .을 명시적으로 표시
* 즉, 루트 도메인부터 kr, jp 등을 찾고 하위 도메인 서버로 거슬러 내려가며 찾는다.

루트 도메인은 모든 DNS 서버에 등록한다.
* 어느 DNS 서버라도 루트 도메인에 엑세스할 수 있게 된다.
* 전 세계에 13개 뿐이기 때문에 어렵지 않다.

# 4. DNS 서버는 캐시 기능으로 빠르게 회답할 수 있다.
DNS 서버는 한 번 조사한 이름을 캐시에 기록할 수 있다.
* 캐시에 있으면 빠르게 정보를 회답
* 조회 결과가 없다는 것또한 캐시에 등록 가능
* 캐시의 데이터가 항상 유효함은 보장할 수 없다.
  * 캐시에 저장하고 정보가 변경되는 경우
  * 따라서 데이터의 유효 기간이 지나면 데이터를 삭제