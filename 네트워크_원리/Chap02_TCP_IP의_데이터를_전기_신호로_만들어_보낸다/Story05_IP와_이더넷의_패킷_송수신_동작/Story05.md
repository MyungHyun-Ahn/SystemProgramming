# Story05 - IP와 이더넷의 패킷 송수신 동작
## 1. 패킷의 기본
IP 담당 부분이 어떻게 패킷을 상대방에게 송신하는지

패킷의 기본형
* 헤더
  * 제어 정보가 들어감
* 데이터

TCP/IP의 패킷
* MAC 헤더 - 이더넷의 패킷
* IP 헤더 - IP의 패킷
* TCP 헤더 - TCP의 패킷
* 데이터 조각

패킷의 송신처가 되는 기기가 패킷을 만든다.
* 헤더에는 적절한 제어 정보 기록
* 데이터 부분에는 데이터
* 가장 가까운 중계 장치에 송신
* 도착하면, 도착한 패킷의 헤더를 조사하여 패킷의 목적지 판단
  * 이때 수신처가 어느 방향에 있는지 기록된 표를 사용
* 다음 중계 장치로 송신
* 반복하여 수신처의 기기까지 패킷이 도착

송신처에서 수신처로 패킷을 보내면 수신처에서 송신처로 회답 패킷이 돌아옴
* 수신처와 송신처가 바뀌는 현상
* 수신처와 송신처를 구분하지 않는 것이 편리
* 엔드노드 : 수신처와 송신처를 묶어 표현

서브넷은 라우터와 허브라는 두 종류의 패킷 중계 장체에서 다음과 같은 역할을 분담하여 패킷을 운반
1. 라우터가 목적지를 확인하여 다음 라우터를 나타냄
2. 허브가 서브넷 안에서 패킷을 운반하여 다음 라우터에 도착

라우터는 IP의 규칙에 따라 패킷을 운반하므로 설명을 바꿔보면
1. IP가 목적지를 확인하여 다음 IP의 중계 장치를 나타냄
2. 서브넷 안에 있는 이더넷이 중계 장치까지 패킷을 운반

TCP/IP의 패킷에는 다음 두 개의 헤더가 붙어있다.
* MAC 헤더(이더넷용 헤더)
* IP 헤더(IP용 헤더)

서버에서 클라이언트로의 패킷 송신과정
1. 클라이언트에서 서버의 IP 주소를 IP 헤더의 수신처에 기록
2. IP는 수신처가 어느 방향에 있는지를 조사하고, 그 방향에 있는 다음 라우터를 조사
3. 거기로 패킷이 도착하도록 MAC 헤더를 부착
4. 다음 라우터에 도착하고 MAC 헤더를 다음 라우터로 교체
5. 반복하며 서버에 도착

## 2. 패킷 송수신 동작의 개요
프로토콜 스택의 IP 담당 부분의 패킷 송신 동작
* IP 담당 부분은 패킷을 상대에게 송출만 함
* 나머지는 허브나 라우터 같은 네트워크 기기의 역할

패킷 송수신 동작의 출발점
* TCP 담당 부분이 IP 담당 부분에 패킷 송신을 의뢰하는 곳부터 시작
* TCP 담당 부분은 데이터의 조각에 TCP 헤더를 추가한 것을 IP 담당 부분에 건네줌
* 상대에게 패킷을 보내달라고 요청한 것

IP 헤더
* IP 프로토콜에 규정된 규칙에 따라 IP 주소로 표시된 목적지까지 패킷을 전달할 때 사용하는 제어 정보를 기록한 것

MAC 헤더
* 이더넷 등의 LAN을 사용하여 가장 가까운 라우터까지 패킷을 운반할 때 사용하는 제어 정보를 기록

이제 패킷을 네트워크용 하드웨어에 건네줌
* 이더넷이나 무선 LAN을 말함
* 0과 1의 디지털 데이터
* LAN 어댑터에 의해 전기나 빛의 신호 상태로 바뀌어 케이블에 송출

## 3. 수신처 IP 주소를 기록한 IP 헤더를 만든다