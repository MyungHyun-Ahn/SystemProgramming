# Story01 - ADSL 기술을 이용한 액세스 회선의 구조와 동작
## 1. 인터넷의 기본은 가정이나 회사의 LAN과 같다
인터넷
* 단순히 가정이나 회사의 네트워크 규모가 커진 것

가정, 회사의 LAN과 인터넷의 차이
* 중계 장치 간의 거리
    * 회사나 가정 : 길어야 수백 m
    * 인터넷 : 수 km
* 라우터에서 패킷의 중계 대상을 제어하는 부분
    * 인터넷의 라우터에는 경로 정보가 10만 개 이상 등록
    * 정보 또한 시시각각 변화
    * 도저히 사람의 손으로는 등록불가 - 자동화해야 한다

## 2. 사용자와 인터넷을 연결하는 액세스 회선
스위칭 허브와 라우터로 패킷을 중계하면 패킷은 목적지 서버를 향해 진행
* 인터넷 접속용 라우터를 경유하여 인터넷으로 나감

인터넷 접속용 라우터의 패킷 중계 동작
* 기본적으로 이더넷의 라우터와 거의 같다.
* 라우팅 테이블에서 찾아 중계 대상에 패킷을 송신

하지만 송신 동작은 조금 다르다.
* 액세스 회선의 규칙에 따라 패킷 송신 동작을 실행

액세스 회선
* 인터넷과 가정, 회사의 LAN을 연결하는 통신 회선
* 일반 가정 : ADSL, FTTH, CATV 등
* 회사의 경우 전용 회선 등이 추가

## 3. ADSL 모델에서 패킷을 셀로 분할한다
ADSL 기술을 사용한 액세스 회선의 내용
* 사용자 측의 라우터에서 송신된 패킷은 ADSL 모뎀이나 전화의 케이블을 통해 전화국에 도착
* ADSL 사업자의 네트워크를 경유하여 프로바이더(ISP)에 도착

프로바이더에 도착하는 동안 패킷은 여러 형태로 모습을 바꾸며 진행

ADSL 모습을 바꾸는 패킷
1. 클라이언트 PC
    * IP 헤더를 붙임
    * MAC 헤더를 붙여서 보냄
2. 인터넷 접속용 라우터
    * 패킷 수신
    * IP 패킷 추출
    * PPP, PPPoE, MAC의 각 헤더를 붙임
3. ADSL 모뎀
    * 패킷 수신
    * ATM 셀로 분할
    * 전기 신호로 변환하여 송출
4. DSLAM(전화국용 집합 모뎀) : 여기부터 ADSL 사업자
    * 전기 신호 수신
    * ATM 셀에 되돌려 송신
5. BAS(광대역 액세스 서버)
    * ATM 셀 수신
    * 패킷의 형태로 되돌림
    * PPP 패킷 추출
    * 터널링용 헤더를 붙여 송신(L2TP 터널링의 경우)
6. 라우터(터널링용)
    * 터널링의 패킷 수신
    * IP 패킷 추출
    * 인터넷 내부를 향해 송신


인터넷 접속용 라우터가 패킷을 송신하면 ADSL 모뎀에 도착
* ADSL 모뎀은 패킷을 작제 분할하여 셀에 저장
* 셀의 맨 앞부분에 헤더(5바이트) - 뒤에 데이터(48바이트) 덩어리
    * ATM이라는 통신 기술에 사용
    * 패킷을 작게 만든 것 - 데이터 부분에 패킷을 분할한 조각을 저장

셀로 분할하는 이유
* ADSL 개발 당시 ATM 통신 기술이 유력시되었음
* 셀을 사용하는 상태로 두면 다른 설비(ATM)와 매끄럽게 연대되어 개발 투자나 설비 투자를 줄일 수 있음

## 4. ADSL은 변조 방식으로 셀을 신호화한다
셀 저장 이후 신호로 변환한다.
* ADSL은 LAN과 달리 복잡한 방식으로 신호를 변환함

ADSL이 복잡한 이유
1. 파형이 뭉개지기 쉽고 거리가 떨어진 경우 오류를 일으키기 쉬움
2. 사각형 신호에는 낮은 주파수에서 높은 주파수까지 넓은 범위의 주파수가 포함되어 있음
    * 신호의 주파수가 높아지면 주위에 방사되는 잡음의 양이 증가하기 때문에 잡음을 제어하기 힘들어짐

ADSL의 변조 기술
* 완만한 파형(정현파)을 합성한 신호에 0과 1의 비트 값을 대응시키는 기술

변조 기술의 종류
* 진폭 변조(ASK)
* 위상 변조(ASK)
* 직교 진폭 변조(QAM) : 두가지 방식의 결합

### 진폭 변조 방식
신호의 진폭의 크기에 0과 1을 대응시키는 방법
* 진폭이 작은 신호 - 0, 큰 신호 - 1로 대응시키는 것이 가장 간단한 예
    * 2단계
* 단계를 늘리면 대응시키는 비트 수를 늘릴 수 있다.
    * 4단계로 두면 00, 01, 10, 11 - 2비트 값에 대응
* 단계를 늘릴수록 운반하는 데이터 양이 늘어나서 속도가 향상됨
* 하지만 너무 많은 단계를 두면 수신측에서 인접 단계와 오인할 가능성이 커진다.

### 위상 변조 방식
신호의 위상에 0과 1을 대응시키는 방법
* 모뎀이 만드는 신호는 일정 주기로 변화하는 파의 일종
* 순환주기에 따라 모양이 다름
* 파는 일주기에 원래의 모습으로 돌아온다.
    * 이것을 원에 적용하여 0에서 360의 각도로 표현
* 이 각도를 위상이라하고 0과 1을 여기에 대응시키는 것이 위상 변조

### 직교 진폭 변조 방식
두 가지를 결합한 것
* 신호의 진폭과 위상에 각각 1비트를 대응
* 한 개의 파에 2비트분의 데이터를 대응

## 5. ADSL은 파를 많이 사용하여 고속화를 실현한다
신호를 단일 주파수의 파로 한정할 필요는 없다.
* 주파수가 서로 다른 파를 혼합하면 합성 가능
* 특정 주파수의 파만 통과시키는 필터 회로를 통해 파를 분리 가능
* 대응시키는 비트 수는 사용하는 파의 수를 곱한 것만큼 증가
* ADSL은 이 성질을 이용하여 고속화

ADSL은 업로드와 다운로드의 전송 속도가 다름
* 업로드는 26개 파
* 다운로드는 95개나 223개의 파를 사용

다운로드에 사용하는 높은 주파수의 파는 감쇠가 크고 잡음의 영향을 받기 쉬우므로 적은 비트 수만 지원하거나 전혀 사용하지 못할 수 있다.
* 거리가 멀어질수록, 주파수가 높아질수록 이러한 경향은 강해지기 때문에 전화국에서 멀어지면 속도가 떨어지는 것

트레이닝
* 모델의 전원을 공급할 때 보내는 시험 신호
* 파의 수나 비트 수를 판단

## 6. 스플리터의 역할
ADSL 모뎀에서 전기 신호로 변환된 셀은 스플리터라는 장치에 들어감
* 히루 ADSL의 신호는 전화의 음성 신호와 섞여서 전화 회선에 함께 흘러나감
* 사용자측에서 신호를 전화 회선에 송출할 때는 전화와 ADSL 양쪽의 신호를 그대로 흘리기만 하며, 스플리터는 하는 일이 없다.

스플리터가 일을 하는 경우 - 전화 회선에서 신호가 흘러들어온 경우
* 전화와 ADSL의 신호를 나누는 역할을 한다.
* 전화 회선에서 흘러들어온 신호는 전화와 ADSL의 신호가 혼합되어 있어 ADSL의 신호가 잡음이 된다.
* 이 신호를 분리하는 것이 스플리터의 역할
    * 정확히는 ADSL의 신호가 높은 주파수를 가지므로 높은 주파수의 신호를 차단하는 것

## 7. 전화국까지의 여정
스플리터의 앞에는 전화 케이블을 꽂은 모듈형 커넥터가 있다.
* IDF나 MDF
* 이후 보안기 - 낙뢰 등의 과대한 전류를 방어
* 이후 전주의 전화 케이블
    * 지하로 들어가는 시점 - 궤선점
    * 지하 케이블을 모아서 매설하는 부분 - 동도
    * 동도를 통해 전화국에 들어간 케이블은 전화국의 MDF에 하나씩 연결

## 8. 잡음의 영향
트위스트 페어 케이블에서 잡음
* 사각형 신호가 한개 흐르기 때문에
* 변형되면 디지털 데이터를 읽을 수 없게 되어 오류 발생

ADSL에서 잡음
* 즉시 오류가 발생하지 않음
* 다수의 주파수로 나뉘어져 잡음과 주파수가 겹치는 신호만 영향
* 즉, 사용할 수 있는 신호의 수가 감소하여 속도가 저하

## 9. DSLAM을 통과하여 BAS에 도달한다
전화 케이블을 통해 전화국에 도착한 신호가 배선반과 스플리터를 통과하여 DSLAM에 도착
* 전기 신호가 디지털 데이터의 셀로 복원
* 다수의 ADSL 모뎀에 해당하는 기능을 묶은 것이 DSLAM

DSLAM이 ADSL 모뎀과 다른 부분
* DSLAM은 이더넷 대신 ATM 인터페이스를 가진 것이 대부분
* 패킷을 분할한 셀 형태 그대로 후방의 라우터와 주고 받음

DSLAM을 통과하여 BAS 패킷 중계 장치에 도착
* ATM 인터페이스가 있고 셀을 수신
* 셀을 원래의 패킷으로 복원하며 BAS 수신 동작은 끝
* MAC 헤더와 PPPoE헤더를 버리고 PPP 헤더 이후의 부분을 추출
* 터널링용 헤더를 붙여 터널링의 출구를 향해 중계

터널링의 출구에 있는 터널링용 라우터에 도착하고
* IP 패킷을 추출하여 인터넷 내부에 중계