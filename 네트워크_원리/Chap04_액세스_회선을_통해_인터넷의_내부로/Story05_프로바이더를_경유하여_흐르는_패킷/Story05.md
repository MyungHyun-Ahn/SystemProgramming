# Story05 - 프로바이더를 경유하여 흐르는 패킷
## 1. 프로바이더끼리의 접속
POP의 라우터에 도착한 패킷의 움직임

최종 목적지가 되는 웹 서버가 클라이언트와 같은 프로바이더에 접속되어 있는 경우
* 프로바이더의 라우터는 라우터끼리 경로 정보를 교환하고 라우팅 테이블에 자동으로 등록
* 경로 정보를 자동화하므로 라우팅 테이블을 검색하면 중계 대상이 판명
  * 중계 대상은 NOC일 수도, POP일 수도 있다.
  * 어떤 경우라도 라우터가 있기 때문에 같은 방법으로 패킷을 중계
* 이 동작을 반복하면 패킷은 이 중 웹 서버측의 POP에 설치한 라우터에 도착하고 웹 서버를 향함

서버측의 프로바이더가 클라이언트측과 다른 경우
* 패킷을 서버측의 프로바이더에 보내야 함
* 이때의 중계 대상 또한 라우팅 테이블에 등록되어 있음
  * 서로 다른 프로바이더와도 경로 정보를 공유
* 경로표를 찾으며 패킷을 보냄

즉, 인터넷의 라우터에는 종류와는 상관 없이 모든 경로가 등록되어 있다.
* 중계 대상을 찾아 패킷을 보내는 동작을 반복하면 지구 반대편까지도 패킷 전달 가능

## 2. 프로바이더끼리 경로 정보 교환하기
라우터에 경로 정보를 자동 등록하는 방법
* 접속 상대가 경로 정보를 가르쳐 줌
  * 이로써 그곳에 어떤 네트워크가 있는지 알 수 있게 됨
* 상대가 경로 정보를 가르쳐주면 이쪽에서도 같은 방법으로 경로 정보를 상대에게 통지

BGP
* 경로 정보 교환을 라우터가 자동으로 수행하고 사용하는 구조

경로 정보 교환은 통지 내용에 따라 두 가지 유형으로 나뉨
1. 인터넷의 경로를 전부 상대에게 통지하는 것
    * 트랜지트(transit)
    * 프로바이더는 상대 프로바이더의 앞에 있는 경로까지 모두 볼 수 있게 됨
2. 각각의 네트워크에 관한 경로 정보만 상대에게 통지하는 것
   * 서로 상대의 네트워크로 갈 패킷만 흐르게 됨
   * 비트랜지트, 피어(peer)라고 함

## 3. 사내 네트워크에서 자동 등록하기
사내에서 사용하는 구조
* 목적지까지의 최단 경로를 찾아 거기에 패킷을 중계
* 주변에 있는 전체 라우터와 무차별적으로 경로 정보를 교환

인터넷은 단순히 최단 경로를 선택하지 않음
* 의도하지 않은 상대로부터 오는 패킷을 중지하는 구조가 필요
* 다른 프로바이더(해외)의 패킷이 흘러들어올 수 있다. - 비용 문제

인터넷의 경로 정보 교환 구조
* 교환 상대를 지정 가능
* 프로바이더끼리의 정보 교환은 특정 라우터와 1대1로 이루어짐
  * 이렇게 해서 비용 부담 등의 교섭에 응한 상대에게만 경로 정보를 통지
* 경로를 판단할 때 경로외에 다른 매개변수로 설정할 수 있다.

## 4. IX의 필요성
프로바이더끼리 접속하는 방법
* 1 대 1 형태로 접속
* 프로바이더는 너무 많으므로 불편함

따라서 IX라는 중심이 되는 설비를 설치함
* 프로바이더는 IX에 연결
* 통신 회선의 수를 줄일 수 있다.

## 5. IX에서 프로바이더끼리 접속하는 모습
IX의 중심
* 고속 LAN의 인터페이스를 다수 장착한 레이어 2 스위치가 있다.
* 레이어 2 스위치의 기본 동작은 스위칭 허브와 같음
  * 고속으로 거대한 스위칭 허브가 IX의 핵심

프로바이더의 라우터를 IX에 연결하는 방법
* IX와 같은 건물에 NOC를 설치한 프로바이더가 선택하는 방법 
  * 통신회선으로 연결

패킷이 어떻게 움직이는지
* IX의 스위치는 스위칭 허브와 같이 동작
  * 라우터에서 패킷을 송신할 때 ARP에서 중계 대상 라우터의 인터페이스의 MAC 주소를 조사하여 이것을 MAC 헤더에 기록하여 패킷을 보냄
  * 헤더에 MAC 주소를 기록하면 어느 프로바이더의 라우터에도 패킷을 보낼 수 있다.