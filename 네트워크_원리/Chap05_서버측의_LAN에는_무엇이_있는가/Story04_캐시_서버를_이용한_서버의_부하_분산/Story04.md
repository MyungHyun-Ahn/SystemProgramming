# Story04 - 캐시 서버를 이용한 서버의 부하 분산
## 1. 캐시 서버의 이용
데이터 베이스와 웹 서버 같은 역할에 따라 서버를 나누는 방법
* 캐시 서버

캐시 서버
* 프록시라는 구조를 사용하여 데이터를 캐시에 저장하는 서버

프록시
* 웹 서버와 클라이언트 사이에 들어가서 웹 서버에 대한 액세스 동작을 중개하는 역할
* 캐시
  * 액세스 동작을 중개할 때 웹 서버에서 받은 데이터를 디스크에 저장해 두고 웹 서버를 대신하여 데이터를 클라이언트에 반송하는 기능

웹 서버 vs 캐시 서버
* 웹 서버는 URL을 점검, 액세스 권한을 점검 등 처리를 하는데 다소 시간이 걸림
* 캐시 서버는 받아둔 데이터를 읽어서 송신만함 - 빠르다.

캐시에 데이터를 저장한 후 웹 서버측에서 데이터가 변경되면 캐시의 데이터를 사용할 수 없다.
* 언제나 캐시 데이터를 이용할 수 있는 것은 아님
* 액세스 동작의 일정 부분은 웹 서버를 번거롭게 하지 않고 캐시 서버에서 처리 가능
* 캐시 서버에서 액세스 동작을 고속화하면 전체 성능이 향상

## 2. 캐시 서버는 갱신일로 콘텐츠를 관리한다
캐시 서버의 동작
* 부하 분산 장치와 마찬가지로 캐시 서버를 DNS 서버에 등록
* 사용자가 리퀘스트 메시지를 보내면 캐시 서버에 도착
* 캐시 서버에서 리퀘스트 메시지의 내용을 조사하고, 데이터가 자신의 캐시에 저장되었는지 조사

캐시 서버의 동작 두 가지
* 캐시에 저장
  * 변경이 없음을 확인하고 전송
* 캐시에 없음
  * 캐시 서버를 경유하여 웹 서버에 도착
  * Via라는 헤더 필드를 추가하여 웹 서버에 리퀘스트를 전송
  * 만약 연결 된 웹 서버가 1대라면 그냥 보냄
  * 여러대라면 URI를 기반으로 판단
  * ex dir1 -> URL1, dir2 -> URL2
  * 그리고 응답 메시지를 캐시 서버에 저장

## 3. 프록시의 원점은 포워드 프록시
포워드 프록시
* 클라이언트 측에 캐시 서버를 두는 것
* 캐시를 이용하는 것 이외에 방화벽을 실현한다는 목적도 있다.
  * 프록시 구조
    * 프록시에서 리퀘스트 메시지를 일단 받아서 인터넷을 향해 전송
    * 필요한 것을 통과시킬 수 있다는 개념
  * 프록시의 캐시를 이용하면 더욱 효과적
  * 프록시는 리퀘스트의 내용을 조사한 후 검사
    * 판단 근거로 더 자세한 조건을 설정 가능

포워드 프록시 사용
* 브라우저의 설정에서 프록시 서버 항목에 포워드 프록시 IP 주소를 설정
* 포워드 프록시를 설정하면 URL의 내용에 상관없이 리퀘스트를 전부 포워드 프록시에 보냄

## 4. 포워드 프록시를 개량한 리버스 프록시
포워드 프록시는 브라우저 설정이 필요하다.
* 번거롭다.
* 장애에 대한 제약사항이 된다.

웹 서버는 누가 액세스하는지 알 수 없고, 브라우저에 프록시 설정 불가
* 따라서 포워드 프록시를 선택하지 않는다.

따라서 서버측에 프록시를 설치한다.
* 리버스 프록시

## 5. 트랜스페어런트 프록시
트랜스페어런트 프록시
* 리퀘스트 메시지의 IP 헤더에서 수신처 IP 주소를 좌하여 액세스 대상 웹 서버가 어디에 있는지 알아내는 방법
* 보통의 리퀘스트 메시를 전송할 수 있으므로 포워드 프록시처럼 브라우저에 설정할 필요가 없음
* 전송 대상을 캐시 서버에 설정할 필요도 없으며 어느 웹 서버에서나 전송 가능
* 리버스, 포워드 프록시의 장점만 모은 형태

트랜스페어런트 프록시에 리퀘스트를 건네주는 방법
* 트랜스페어런트 프록시는 DNS 서버에 등록하지 않는다.
* 전송 대상이 웹 서버임
  * 리퀘스트 메시지는 프록시 서버로 흘러가지 않고 웹 서버로 흘러감
* 해결 방법
  * 리퀘스트 메시지가 흘러가는 길에 설치
  * 트랜스페어런트 프록시를 지나가는 순간에 그것을 가로챔

장점
* 사용자가 프록시의 존재를 알아차릴 필요가 거의 없음
* HTTP의 메시지를 전송한다는 구조에 대한 관심이 적어지고 캐시를 이용한다는 측면