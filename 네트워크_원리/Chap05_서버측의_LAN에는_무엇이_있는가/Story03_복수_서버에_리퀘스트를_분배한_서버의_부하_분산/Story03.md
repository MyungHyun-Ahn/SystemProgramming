# Story03 - 복수 서버에 리퀘스트를 분배한 서버의 부하 분산
## 1. 처리 능력이 부족해지면 복수 서버로 부하 분산된다
분산 처리
* 복수의 서버를 사용하여 처리를 분담하는 방법
* 서버 한 대당 처리량을 줄이는 것

### 처리를 분담하는 방식
가장 단순한 방법 - 여러 대의 웹 서버를 설치하고 한 대가 담당하는 사용자 수를 줄이는 법
* 클라이언트가 보내는 리퀘스트를 웹 서버에 분배하는 구조가 필요
  * DNS 서버에서 분배
    * 같은 이름으로 여러 대의 웹 서버를 등록해둠
    * 조회가 있을 때마다 차례대로 IP 주소를 되돌려줌
    * 라운드 로빈 방식이라 한다.
  * 이 방식의 결점
    * 고장나는 웹 서버가 있을 때
    * 고장난 웹 서버로 연결시킬 수 있다.

## 2. 부하 분산 장치를 이용해 복수의 웹 서버로 분할된다
부하 분산 장치 또는 로드 밸런서
* 먼저 부하 분산 장치를 웹 서버 대신 DNS 서버로 등록
* 그럼 클라이언트는 부하 분산 장치로 리퀘스트 메시지를 전송한다.

어느 웹 서버에 리퀘스트 메시지를 전송해야 하는지 판단 근거
* 복수 페이지에 걸쳐있지 않은 경우
  * 웹 서버의 부하 상태가 판단 근거
  * 웹 서버와 정기적으로 정보를 교환하여 CPU나 메모리의 사용률 등을 수집
  * 이것을 바탕으로 어느 웹 서버의 부하가 낮은지 판단하거나 시험 패킷을 웹 서버에 보내 응답시간을 판단
    * 부하는 단시간에 증가하거나 감소 꼼꼼히 조사하지 않으면 정확히 판단 불가
    * 그렇다고 너무 자세하게 조사하면 웹 서버에 부하가 증가
* 복수 페이지에 걸쳐있을 때
  * 웹 서버의 부하에 관계 없이 이전의 리퀘스트와 같은 웹 서버에 전송
  * 먼저 복수 페이지에 걸쳐있는지 판단
  * 웹 서버 측에서는 이전 리퀘스트와의 관계를 판단 불가
    * HTTP가 이렇게 만들어졌기 때문
  * 리퀘스트의 송신처 IP 주소가 같다면 일련의 것이라는 것? - 그럴 수 없다.
  * 송신처 IP 주소가 프록시 IP 주소인 경우 실제로 누가 보냈는지 모른다.
  * HTTP 필드에 추가 정보를 부가하는 방법
    * 이 필드를 통해 같은 웹 서버에 접속시킨다.