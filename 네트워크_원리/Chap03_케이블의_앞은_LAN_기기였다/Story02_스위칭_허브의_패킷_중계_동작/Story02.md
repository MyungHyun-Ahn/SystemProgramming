# Story02 - 스위칭 허브의 패킷 중계 동작
## 1. 스위칭 허브는 주소 테이블로 중계한다
스위칭 허브
* 이더넷의 패킷을 그대로 목적지를 향해 중계하도록 만들어져 있다.

스위칭 허브의 수신
* 신호가 커넥터 부분에 도달하여 PHY 회로에서 수신되는 부분까지는 리피터 허브와 같다
* PHY 회로에서 케이블을 흐르는 신호의  형삭부터 공통의 신호 형식으로 변환 후 MAC 회로로
* FCS를 대조하여 문제가 없으면 버퍼 메모리에 저장

스위칭 허브의 포트
* 커넥터와 안쪽에 있는 회로 부분
* 스위칭 허브의 포트는 수신처 MAC 주소를 검사하지 않고 모두 수신
* MAC 주소가 할당되어 있지 않다.

버퍼 메모리 저장 이후
* 다음 수신처 MAC 주소와 일치하는 것이 있는지 MAC 주소표에서 조사
* MAC 주소와 포트가 짝을 이루고 있으므로 어디로 송신할지를 판단

스위치 회로의 구조
* 입력 출력을 표구조를 전자 회로로 만든 것
* 입력 포트와 출력 포트를 연결
* 포트 사이에 패킷을 운반할 때는 이 회로에 패킷의 신호를 흘림

송신 동작은 LAN 어댑터와 같다.
* 여기서도 송신 동작 중 다른 기기가 보낸 신호가 수신측에 들어오면
* 재밍 신호를 보내 송신 동작을 잠시 중지하고 다시 보냄

## 2. MAC 주소 테이블을 등록 및 갱신한다
스위칭 허브는 패킷을 중계할 때 MAC 주소표의 내용을 갱신하는 동작도 실행

갱신 동작의 두 종류
1. 송신처 MAC 주소를 조사하고, 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC 주소표로 등록하는 것
   * 송신처 주소를 등록해 두면 MAC 주소로 갈 패킷을 수신했을 때 이것이 존재하는 포트에 중계할 수 있다.
   * 이러한 등록 동작을 한 번이라도 했다면 해당 기기의 MAC 주소가 MAC 주소표에 등록됨
2. MAC 주소표에 등록되어 있는 내용을 지우는 동작
   * 기기를 이동한 경우의 불편함을 방지하기 위함
   * 일정 시간이 지나면 삭제 - 보통은 몇 분

## 3. 예외적인 동작
송신 포트가 패킷을 수신한 포트와 같다고 가정
* 스위칭 허브에 리피터 허브가 접속되어 있는 경우 발생
* 이걸 방지하기 위해 스위칭 허브에서 수신 포트와 송신 포트가 같을 경우 패킷을 중계하지 않고 폐기

MAC 주소표에 수신처 MAC 주소가 없는 경우
* 주소의 기기에서 패킷이 한 번도 스위칭 허브에 도착하지 않았거나 삭제된 경우
* 이 경우에는 수신한 포트 이외의 전체 포트에 패킷을 송신
* 처음 작업 이후 MAC 주소표에 등록되고 전체에 패킷을 보내지 않게됨

LAN에는 1초에 수천 개 이상의 패킷을 보내는 능력이 있다.

## 4. 전이중 모드에서 송신과 수신을 동시에 실행한다
전이중 모드
* 송신과 수신을 동시에 실행할 수 있는 성질
* 스위칭 허브의 특징
* 스위칭 허브를 사용하면 충돌이 일어나지 않는다.
  * 트위스트 페어 케이블의 신호선은 송신용과 수신용으로 나뉘어져 있다.
* 신호가 흐르고 있어도 상관하지 않고 송신해도 좋다.
  * 반이중 모드보다 빠르게 동작
  * 성능 또한 좋다

## 5. 최적의 전송 속도로 보내는 자동 조정
자동 조정(auto negotiation)
* 전이중 모드와 반이중 모드를 상대의 전송 속도를 검출하여 자동으로 전환

링크 펄스
* 이더넷은 데이터가 흐르고 있지 않을 때 링크 펄스라는 펄스형의 신호를 흘림
* 이것을 통해 상대가 올바르게 작동하는지 등의 상태를 확인

자동 조정 기능은 펄스 신호를 사용
* 펄스 신호의 패턴에 의해 지원 가능한 모드와 전송 속도를 서로 통지하고
* 그 중 최적의 조합을 선택하여 설정

## 6. 스위칭 허브는 복수의 중계 동작을 동시에 실행한다
스위칭 허브는 수신처 MAC 주소의 기기가 존재하는 포트 이외에는 송신 동작을 실행하지 않음
* 다른 포트는 빈 상태
* 빈 포트에 별도의 패킷을 흘릴 수 있기 때문에 동시에 여러 개 패킷을 중계 가능

리피터 허브는 복수의 신호를 동시에 흘릴 수 없다.