# Story01 - 케이블과 리피터, 허브 속을 신호가 흘러간다.
## 1. 하나하나의 패킷이 독립된 것으로 동작한다
컴퓨터에서 송신된 패킷
* 허브나 라우터라는 중계 장치에 의해 중계되어 목적지를 향해 진행
* 패킷의 헤더에 기록된 제어 정보와 중계 장치의 내부에 있는 중계 대상을 등록한 표로 목적지를 판단하고 목적지에 가까워지도록 하여 패킷을 중계함
* 데이터 부분은 보지 않는다.
  * 즉, 애플리케이션의 데이터 혹은 TCP의 제어 정보는 패킷 운반에 영향을 주지 않는다.

이번 장에서는 클라이언트 PC가 같은 LAN에 접속되어 있는 것을 가정
* 클라이언트 PC가 송신한 패킷이 리피터 허브, 스위칭 허브, 라우터를 경유하여 인터넷에 나가는 것으로 간주
* 단일 기능의 여러 개 기기를 연결해서 사용하는 것으로 하고 살펴본다.

LAN의 구성
* 클라이언트 -> 리피터 허브 -> 스위칭 허브 -> 라우터 -> 인터넷 접속용 라우터 -> 액세스 회선 -> 인터넷

## 2. LAN 케이블은 신호를 약화시키지 않는 것이 핵심
LAN 어댑터에서 패킷이 송신되어 케이블로 나가는 부분부터 시작
* PHY 회로에서 전기 신호로 형태를 바꾼 패킷은 트위스트 페어 케이블에 들어감
* 그 신호는 케이블을 흘러 리피터 허브의 커넥터 부분에 도착
  * 단순히 전기 신호가 케이블을 통해 전달되는 것
  * 허브에 도착할 때는 신호가 약해져 있음
  * 사각형의 신호에서 각이 뭉개져 둥글해진다.
  * 잡음까지 더해지면 0과 1을 잘못 해석할 수도 있다.

## 3. '꼼'은 잡음을 방지하기 위한 방법이다
트위스트 페어 케이블
* 잡음의 영향을 억제하는 대책이 마련되어 있다. - 트위스트(꼼)

잡음이 생기는 원리
* 잡음의 원인 - 케이블의 주위에서 발생하는 전자파
* 전자파가 금속 등의 도전체에 닿으면 그 안에 전류가 발생
* 케이블 주위에 전자파가 있으면 신호와는 다른 전류가 케이블 안에 흐른다.
* 그 결과 신호의 잡음과 전류가 뒤섞여 신호의 파형이 변형

케이블에 영향을 받는 전자파 두 종류
1. 모니터, 형광등 등의 기기에서 누설되는 전자파
   * 케이블 밖에서 오는 것 - 선을 꼬아 막을 수 있다.
   * 신호선은 금속 - 전자파가 닿으면 전자파의 진행 방향의 오른쪽으로 전류가 생기는 성질
   * 신호선을 마주 꼬면 꼰 옆의 선에서 전류가 흐르는 방향이 반대가 된다.
   * 잡음에서 생긴 전류가 서로 상쇄되어 잡음에 의한 전류는 약해진다.
2. 케이블 안의 인접한 신호선에서 누설되는 전자파
   * 신호선 안에는 신호라는 전류가 흐르므로 전류에 의해 주위에 전자파가 생김
   * 이것이 다른 신호선에 대한 잡음이 된다.
   * 이런 잡음에 대한 영향을 크로스토크(crosstalk)라고 함

케이블 안의 잡음
* 원래 강한 것은 아니지만 거리가 가까운 곳이 문제
* 그런데 케이블 안의 신호선은 거리가 가까움

이것을 막는 대책 또한 마주 꼬는 것
* 신호선을 꼬는 간격을 약간씩 다르게
* 어느 부분에는 플러스 신호가 가까이, 다른 부분은 마이너스 신호가 가까이
* 플러스와 마이너스의 균형이 잡히며 잡음의 영향이 줄어드는 것

또 다른 성능 향상 대책
* 금속성의 실드(shield, 차폐)라는 피복을 입히는 등 여러가지 대책이 있다.

## 4. 리피터 허브는 연결되어 있는 전체 케이블에 신호를 보낸다.
리피터 허브
* 신호가 도달하면 LAN 전체에 신호가 흩어짐

이더넷의 기본 원리
* 전체에 패킷의 신호를 뿌리고 수신처 MAC 주소에 해당하는 기기만 패킷을 수신한다는 원리
* 이것을 그대로 실현한 것이 리피터 허브

리피터 허브의 내부
* 각 커넥터의 안쪽
  * LAN 어댑터의 내부에 있는 PHY 회로와 역할이 같은 회로가 있다.
  * 이것을 LAN 어댑터측과 같이 RJ-45 커넥터에 직접 접속하면 신호를 제대로 수신할 수 없다.
  * 제대로 수신하려면 송신 단자에서 보낸 신호를 수신 단자로 받도록 해야 한다.
  * 따라서 신호선을 교차시켜서 접속

리피터 허브의 끝 커넥터
* MDI/MDI-X 전환 스위치
* MDI는 RJ=45 커넥터와 신호 송수신 회로를 직접 결선
* MDI-X는 교차하여 결선하는 것을 나타냄
* 허브의 커넥터 부분은 보통 MDI-X - 허브끼리 접속할 때는 한쪽을 MDI로
* 만약 MDI로 전환하는 스위치가 없고 모든 커넥터가 MDI-X인 경우
  * 크로스 케이블로 허브들을 접속

크로스 케이블은 PC 끼리 접속할 떄도 사용

리피터 허브에서 PHY 수신부에 도달한 신호는 리피터 회로에 들어감

리피터 회로의 기본
* 들어오는 신호를 리피터 허브의 커넥터 부분에 뿌리는 것
* 이후 신호는 리피터 허브에 접속한 모든 기기에 도달
* 신호를 수신한 기기는 MAC 헤더의 수신처 MAC 주소를 조사하고 자신의 것이 아니면 폐기

잡음의 영향을 받아 변형된 신호도 그대로 흘려버린다.
* 이후 다른 기기에서 FCS를 검사할 때 데이터 변화가 판정되면 폐기
* 그러나 TCP에 의해 패킷이 다시 보내진다.